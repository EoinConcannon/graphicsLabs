<!DOCTYPE html>
<html>

<!-- import -->
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

<head>
    <title>D3.js Demo</title>
    <meta charset="UTF-8">
    <style type="text/css"></style>
</head>

<h1>Eoin Concannon</h1>

<body>
    <script type="text/javascript">

        //Retrieve the JSON data
        $.getJSON("https://pkgstore.datahub.io/core/co2-ppm/co2-mm-mlo_json/data/aed7eb0d19cbcd90790525d40728b0a8/co2-mm-mlo_json.json", function (data) {
            console.log(data);
            plotCO2Data(data);
        });

        //Executed once the file has downloaded
        function plotCO2Data(data) {
            //Set up SVG size and margins
            var margin = { top: 50, right: 50, bottom: 50, left: 50 },
                width = 900 - margin.left - margin.right,
                height = 670 - margin.top - margin.bottom;

            //Create x and y scales for Interpolated value (x-axis) and (y-axis)
            var y = d3.scaleLinear()
                .domain(d3.extent(data, function (d) { return d["Interpolated"] }))//atmospheric CO2 values
                .range([height, 0]);

            //parse the date / time
            var parseDate = d3.timeParse("%Y-%m-%d");//converts string to a date object (Year-Month-Day)

            var x = d3.scaleTime()
                .domain(d3.extent(data, function (d) { return parseDate(d["Date"]); }))
                .range([0, width]);

            //Axes
            //x is the d3.scaleTime()
            var xAxis = d3.axisBottom(x)
                .ticks(3);//specify the number of ticks

            //x is the d3.scaleLinear()
            var yAxis = d3.axisLeft(y)
                .ticks(3);//specify the number of ticks

            var valueLine = d3.line()//draw line - maps x,y coordinates for each data point, using x,y scale functions
                .x(function (d) { return x(parseDate(d["Date"])); })//x pixel value for each data point
                .y(function (d) { return y(d["Interpolated"]); });//y pixel value for each data point

            var svg = d3.select('body')
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)

                .append("g")
                //numeric values visible
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.append('g')//append a <g> - group element
                .attr('class', 'x axis')
                .call(xAxis);//let the axis do its thing

            svg.append('g')
                .attr('class', 'y axis')//specify classes
                .call(yAxis);

            svg.append("path")//add the valueline path
                .attr("stroke", "red")
                .attr("fill", "none")
                .attr("d", valueLine(data));//d = draw

            //TREND DATA
            y = d3.scaleLinear()
                .domain(d3.extent(data, function (d) { return d["Trend"] }))
                .range([height, 0]);

            svg.append("path")
                .attr("stroke", "blue")
                .attr("fill", "none")
                .attr("d", valueLine(data))
            //end of trend data

            //---------------------------------------------------------------------------------------------------------------------------------

            svg.append("text")
                .attr("class", "x label")
                .attr("text-anchor", "end")
                .attr("x", width / 2)
                .attr("y", height)
                .attr("font-size", "30px")
                .text("Time (Years)");
            // .call(zoom);

            //CO2 text
            svg.append("text")
                .attr("class", "y label")
                .attr("text-anchor", "end")
                .attr("x", -100)
                .attr("transform", "rotate(-90)")
                .attr("font-size", "30px")
                .attr("fill", "red")
                .text("Atmospheric CO2");
            // .call(zoom);

            //Trend text
            svg.append("text")
                .attr("class", "y label")
                .attr("text-anchor", "end")
                .attr("x", -400)
                .attr("transform", "rotate(-90)")
                .attr("font-size", "30px")
                .attr("fill", "blue")
                .text("Trend");
            // .call(zoom);


            // https://d3js.org/d3-zoom
            // selection
            //     .call(zoom)
            //     .on("wheel.zoom", null); //not working

            // https://d3-graph-gallery.com/graph/interactivity_zoom.html
            // Set the zoom and Pan features: how much you can zoom, on which part, and what to do when there is a zoom
            var zoom = d3.zoom()
                .scaleExtent([.5, 20])  // This control how much you can unzoom (x0.5) and zoom (x20)
                .extent([[0, 0], [width, height]])
                .on("zoom", updateChart);

            function updateChart() {

                // recover the new scale
                var newX = d3.event.transform.rescaleX(x);
                var newY = d3.event.transform.rescaleY(y);

                // update axes with these new boundaries
                xAxis.call(d3.axisBottom(newX))
                yAxis.call(d3.axisLeft(newY))
            }
        }

    </script>
</body>

</html>